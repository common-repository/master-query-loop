(()=>{"use strict";const e=window.wp.element,t=window.wp.i18n,l=window.wp.blocks,n=window.wp.blockEditor,r=window.wp.hooks,a=(0,e.createElement)("svg",{version:"1.0",encoding:"utf-8",viewBox:"245.212 136.576 94.857 61.076",xmlns:"http://www.w3.org/2000/svg",xmlnsBx:"https://boxy-svg.com"},(0,e.createElement)("path",{d:"M 277.26 136.576 L 309.307 197.651 L 245.212 197.651 L 277.26 136.576 Z",style:{strokeOpacity:.9,fill:"rgb(255, 130, 4)",paintOrder:"stroke"},bxShape:"triangle 245.212 136.576 64.095 61.075 0.5 0 1@87426ad8"}),(0,e.createElement)("path",{d:"M 308.022 136.577 L 340.069 197.652 L 275.974 197.652 L 308.022 136.577 Z",style:{fill:"rgba(254, 173, 80, 0.74)"},bxShape:"triangle 275.974 136.577 64.095 61.075 0.5 0 1@d974d2b5"})),s=window.wp.htmlEntities,i=function(t){let{icon:l,size:n=24,...r}=t;return(0,e.cloneElement)(l,{width:n,height:n,...r})},o=window.wp.primitives,c=(0,e.createElement)(o.SVG,{width:"24",height:"24",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,e.createElement)(o.Path,{d:"M8 7h2V5H8v2zm0 6h2v-2H8v2zm0 6h2v-2H8v2zm6-14v2h2V5h-2zm0 8h2v-2h-2v2zm0 6h2v-2h-2v2z"})),u=(0,e.createElement)(o.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,e.createElement)(o.Path,{d:"M13 19h-2v-2h2v2zm0-6h-2v-2h2v2zm0-6h-2V5h2v2z"})),m=(0,e.createElement)(o.SVG,{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24"},(0,e.createElement)(o.Path,{d:"M20 5h-5.7c0-1.3-1-2.3-2.3-2.3S9.7 3.7 9.7 5H4v2h1.5v.3l1.7 11.1c.1 1 1 1.7 2 1.7h5.7c1 0 1.8-.7 2-1.7l1.7-11.1V7H20V5zm-3.2 2l-1.7 11.1c0 .1-.1.2-.3.2H9.1c-.1 0-.3-.1-.3-.2L7.2 7h9.6z"})),d=window.wp.data,p=window.wp.coreData,h=window.wp.components;function _(l){let{attributes:n,setAttributes:r}=l;const{query:a,namespace:o}=n,[_,v]=(0,e.useState)(""),{searchResults:w,hasResolved:g}=(0,d.useSelect)((e=>{const t={};if(_){t.search=`"${_}"`,t.per_page=20,t._embed="wp:featuredmedia",t._fields="id,excerpt,title,link,_links,_embedded";const l=["postType","post",t];return{searchResults:e(p.store).getEntityRecords(...l),hasResolved:e(p.store).hasFinishedResolution("getEntityRecords",l)}}return{searchResults:[],hasResolved:!0}}),[_]),{posts:y,hasResolvedPosts:E}=(0,d.useSelect)((e=>{const t={};if(a.include){t.include=a.include,t.orderby="include",t._fields="id,title,link";const l=["postType","post",t];return{posts:e(p.store).getEntityRecords(...l),hasResolvedPosts:e(p.store).hasFinishedResolution("getEntityRecords",l)}}return{posts:[],hasResolvedPosts:!0}}),[a.include]),[b,q]=(0,e.useState)(null),[f,k]=(0,e.useState)(!1),x=(0,e.useRef)(null),S=(0,e.useRef)(null),R=(0,e.useRef)(null),P=()=>{const e={...n.query};delete e.include,e.orderBy="date",r({query:e})},N=()=>{if(x.current.id!==b.id){let e=y.filter((e=>e.id!==x.current.id)),t=R.current;R.current>S.current&&t--,f&&(t=e.length),e.splice(t,0,x.current),r({query:{...n.query,include:e.map((e=>e.id)),orderBy:"include"}})}x.current=null,q(null),k(!1),R.current=null,S.current=null};return(0,e.createElement)(h.PanelBody,{title:(0,t.__)("Specific Posts",o),intialOpen:!0},(0,e.createElement)("p",null,(0,t.__)(`Want to display specific posts? Search and insert them here,                 skip this to get posts automatically based on other params.                 The number of posts will be displayed is ITEMS_PER_PAGE number,                 currently is ${a.perPage}.`,o)),(0,e.createElement)("div",{className:"mql-section mql-section--search-post"},(0,e.createElement)(h.TextControl,{type:"search",className:"mql-section__item mql-section__item--text-control",label:(0,t.__)("Search",o),value:_,onChange:e=>v(e)}),!g&&(0,e.createElement)(h.Spinner,null),_&&g&&!w?.length&&(0,e.createElement)("div",{className:"mql-section__item mql-danger"},(0,t.__)("No results",o)),w&&w.length>0&&(0,e.createElement)("ul",{className:"mql-section__item"},w.map((t=>(0,e.createElement)(h.Tooltip,{text:"Select this item"},(0,e.createElement)("li",{key:t.id,onClick:()=>{return e=t,void(0!==y.length&&y.map((e=>e.id)).includes(e.id)||r({query:{...n.query,include:n.query.include?[...n.query.include,e.id]:[e.id],orderBy:"include"}}));var e}},(0,e.createElement)("div",{className:"title"},(0,e.createElement)("p",null,(0,s.decodeEntities)(t.title.rendered)),(0,e.createElement)("small",null,t.link)))))))),(0,e.createElement)("div",{className:"mql-section mql-section--post-include"},E&&(0,e.createElement)("div",{className:"mql-section__item mql-section__item--header"},(0,e.createElement)("span",null,(0,t.__)(`${y?.length} selected posts`,o)),y?.length>0&&(0,e.createElement)("a",{href:"javascript:void(0)",onClick:()=>P(),className:"mql-danger"},(0,t.__)("Delete all",o))),y?.length>0&&(0,e.createElement)("ul",{className:"mql-section__item"+(f?" user-dragging-to-the-last":"")},y.map(((l,a)=>(0,e.createElement)("li",{className:`${a==y.length-1?"is-the-last":""}${b&&l.id===b.id?" is-dragged-over":""}`,id:`selected-item-${l.id}`,key:l.id,onDragOver:()=>{return e=a,k(!1),q(y[e]),void(R.current=e);var e}},(0,e.createElement)(h.Draggable,{elementId:`selected-item-${l.id}`,onDragStart:e=>{return t=a,x.current=y[t],void(S.current=t);var t},onDragEnd:N},(l=>{let{onDraggableStart:n,onDraggableEnd:r}=l;return(0,e.createElement)(h.Tooltip,{text:(0,t.__)("Drag",o)},(0,e.createElement)("div",{style:{display:"flex"},className:"mql-hover-cursor-pointer",draggable:!0,onDragStart:n,onDragEnd:r},(0,e.createElement)(i,{icon:c})))})),(0,e.createElement)("small",null,(0,s.decodeEntities)(l.title.rendered)),(0,e.createElement)(h.Tooltip,{text:(0,t.__)("Options",o)},(0,e.createElement)("div",{className:"mql-hover-cursor-pointer"},(0,e.createElement)(h.DropdownMenu,{icon:u,controls:[{icon:m,onClick:()=>{(e=>{let t=y.filter((t=>t.id!==e));t.length?r({query:{...n.query,include:t.map((e=>e.id)),orderBy:"include"}}):P()})(l.id)},title:(0,t.__)("Delete",o)}]})))))),(0,e.createElement)("div",{className:"mql-drag-last-trick",onDragOver:()=>k(!0)}))))}function v(l){let{attributes:n,setAttributes:r}=l;const{query:a,namespace:s}=n;return(0,e.createElement)(e.Fragment,null,(0,e.createElement)(h.PanelBody,{title:(0,t.__)("Popular Posts",s),initialOpen:!0},(0,e.createElement)("p",null,(0,t.__)("Turn this into `Popular Posts`                     by putting the meta_key that hold information about post view count here.                     Note, this function will not work correctly if you turn off counting post views.",s)),(0,e.createElement)(h.TextControl,{value:a.meta_key_view_count,onChange:e=>(e=>{r({query:{...a,meta_key_view_count:e}})})(e)}),a.meta_key_view_count&&(0,e.createElement)("p",null,(0,t.__)("Choose the date range",s))&&(0,e.createElement)(h.SelectControl,{onChange:e=>(e=>{r({query:{...a,meta_date_range:e}})})(e),value:a.meta_date_range,options:[{value:"",label:(0,t.__)("All",s)},{value:"-1 week",label:(0,t.__)("1 week",s)},{value:"-2 weeks",label:(0,t.__)("2 weeks",s)},{value:"-3 weeks",label:(0,t.__)("3 weeks",s)},{value:"-1 month",label:(0,t.__)("1 month",s)},{value:"-3 months",label:(0,t.__)("3 months",s)},{value:"-6 months",label:(0,t.__)("6 months",s)},{value:"-1 year",label:(0,t.__)("1 year",s)},{value:"-2 years",label:(0,t.__)("2 years",s)},{value:"-3 years",label:(0,t.__)("3 years",s)}].map((e=>{let{value:t,label:l}=e;return{label:l,value:t}}))})))}const w="wpmasterpiece/master-query-loop",g="wpmasterpiece/default-query-loop";(0,l.registerBlockVariation)("core/query",[{name:w,title:"Master Query Loop",description:(0,t.__)("Extends the core/query block with more advanced settings.",w),isActive:e=>{let{namespace:t,query:l}=e;return t===w&&"post"===l.postType},icon:a,attributes:{namespace:w},scope:["inserter","transform"]},{title:"Query Loop",isActive:e=>{let{namespace:t,query:l}=e;return(!t||t===g)&&"post"===l.postType},attributes:{namespace:g,query:{perPage:3,pages:0,offset:0,postType:"post",order:"desc",orderBy:"date",author:"",search:"",exclude:[],sticky:"",inherit:!1}},scope:["transform"]}]),(0,r.addFilter)("editor.BlockEdit","core/query",(t=>l=>function(e){return e.attributes.namespace==w}(l)?(0,e.createElement)(e.Fragment,null,(0,e.createElement)(n.InspectorControls,null,(0,e.createElement)(_,l),(0,e.createElement)(v,l)),(0,e.createElement)(t,l)):(0,e.createElement)(t,l)))})();